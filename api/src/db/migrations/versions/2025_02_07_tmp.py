"""tmp

Revision ID: ea0bd96089db
Revises: 43b179a7c92e
Create Date: 2025-02-07 10:06:25.635991

"""

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "ea0bd96089db"
down_revision = "43b179a7c92e"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "child_history",
        sa.Column("child_id", sa.UUID(), nullable=False),
        sa.Column("is_forecast", sa.Boolean(), nullable=False),
        sa.Column("description", sa.Text(), nullable=True),
        sa.Column("parent_id", sa.Integer(), nullable=False),
        sa.Column(
            "created_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column("version_id", sa.UUID(), nullable=False),
        sa.Column("is_deleted", sa.Boolean(), nullable=False),
        sa.Column("start", sa.TIMESTAMP(timezone=True), nullable=False),
        sa.Column(
            "end", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False
        ),
        sa.PrimaryKeyConstraint("child_id", "version_id", name=op.f("child_history_pkey")),
        schema="api",
    )
    op.create_index(
        op.f("child_history_parent_id_idx"),
        "child_history",
        ["parent_id"],
        unique=False,
        schema="api",
    )
    op.create_table(
        "parent",
        sa.Column("parent_id", sa.BigInteger(), nullable=False),
        sa.Column("opportunity_number", sa.Text(), nullable=True),
        sa.Column("opportunity_title", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.PrimaryKeyConstraint("parent_id", name=op.f("parent_pkey")),
        schema="api",
    )
    op.create_index(
        op.f("parent_opportunity_title_idx"),
        "parent",
        ["opportunity_title"],
        unique=False,
        schema="api",
    )
    op.create_table(
        "parent_history",
        sa.Column("parent_id", sa.BigInteger(), nullable=False),
        sa.Column("opportunity_number", sa.Text(), nullable=True),
        sa.Column("opportunity_title", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column("version_id", sa.UUID(), nullable=False),
        sa.Column("is_deleted", sa.Boolean(), nullable=False),
        sa.Column("start", sa.TIMESTAMP(timezone=True), nullable=False),
        sa.Column(
            "end", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False
        ),
        sa.PrimaryKeyConstraint("parent_id", "version_id", name=op.f("parent_history_pkey")),
        schema="api",
    )
    op.create_index(
        op.f("parent_history_opportunity_title_idx"),
        "parent_history",
        ["opportunity_title"],
        unique=False,
        schema="api",
    )
    op.create_table(
        "child",
        sa.Column("parent_id", sa.BigInteger(), nullable=False),
        sa.Column("child_id", sa.UUID(), nullable=False),
        sa.Column("is_forecast", sa.Boolean(), nullable=False),
        sa.Column("description", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.ForeignKeyConstraint(
            ["parent_id"], ["api.parent.parent_id"], name=op.f("child_parent_id_parent_fkey")
        ),
        sa.PrimaryKeyConstraint("child_id", name=op.f("child_pkey")),
        sa.UniqueConstraint("is_forecast", "parent_id", name=op.f("child_is_forecast_uniq")),
        schema="api",
    )
    op.create_index(op.f("child_parent_id_idx"), "child", ["parent_id"], unique=False, schema="api")
    op.create_table(
        "current_child_history",
        sa.Column("parent_id", sa.BigInteger(), nullable=False),
        sa.Column("child_id", sa.UUID(), nullable=False),
        sa.Column("opportunity_status_id", sa.Integer(), nullable=False),
        sa.Column(
            "created_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column("version_id", sa.UUID(), nullable=False),
        sa.Column("is_deleted", sa.Boolean(), nullable=False),
        sa.Column("start", sa.TIMESTAMP(timezone=True), nullable=False),
        sa.Column(
            "end", sa.TIMESTAMP(timezone=True), server_default=sa.text("now()"), nullable=False
        ),
        sa.ForeignKeyConstraint(
            ["opportunity_status_id"],
            ["api.lk_opportunity_status.opportunity_status_id"],
            name=op.f("current_child_history_opportunity_status_id_lk_opportunity_status_fkey"),
        ),
        sa.PrimaryKeyConstraint(
            "parent_id", "child_id", "version_id", name=op.f("current_child_history_pkey")
        ),
        schema="api",
    )
    op.create_index(
        op.f("current_child_history_child_id_idx"),
        "current_child_history",
        ["child_id"],
        unique=False,
        schema="api",
    )
    op.create_index(
        op.f("current_child_history_opportunity_status_id_idx"),
        "current_child_history",
        ["opportunity_status_id"],
        unique=False,
        schema="api",
    )
    op.create_index(
        op.f("current_child_history_parent_id_idx"),
        "current_child_history",
        ["parent_id"],
        unique=False,
        schema="api",
    )
    op.create_table(
        "current_child",
        sa.Column("parent_id", sa.BigInteger(), nullable=False),
        sa.Column("child_id", sa.UUID(), nullable=False),
        sa.Column("opportunity_status_id", sa.Integer(), nullable=False),
        sa.Column(
            "created_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.ForeignKeyConstraint(
            ["child_id"], ["api.child.child_id"], name=op.f("current_child_child_id_child_fkey")
        ),
        sa.ForeignKeyConstraint(
            ["opportunity_status_id"],
            ["api.lk_opportunity_status.opportunity_status_id"],
            name=op.f("current_child_opportunity_status_id_lk_opportunity_status_fkey"),
        ),
        sa.ForeignKeyConstraint(
            ["parent_id"],
            ["api.parent.parent_id"],
            name=op.f("current_child_parent_id_parent_fkey"),
        ),
        sa.PrimaryKeyConstraint("parent_id", "child_id", name=op.f("current_child_pkey")),
        schema="api",
    )
    op.create_index(
        op.f("current_child_child_id_idx"),
        "current_child",
        ["child_id"],
        unique=False,
        schema="api",
    )
    op.create_index(
        op.f("current_child_opportunity_status_id_idx"),
        "current_child",
        ["opportunity_status_id"],
        unique=False,
        schema="api",
    )
    op.create_index(
        op.f("current_child_parent_id_idx"),
        "current_child",
        ["parent_id"],
        unique=False,
        schema="api",
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("current_child_parent_id_idx"), table_name="current_child", schema="api")
    op.drop_index(
        op.f("current_child_opportunity_status_id_idx"), table_name="current_child", schema="api"
    )
    op.drop_index(op.f("current_child_child_id_idx"), table_name="current_child", schema="api")
    op.drop_table("current_child", schema="api")
    op.drop_index(
        op.f("current_child_history_parent_id_idx"),
        table_name="current_child_history",
        schema="api",
    )
    op.drop_index(
        op.f("current_child_history_opportunity_status_id_idx"),
        table_name="current_child_history",
        schema="api",
    )
    op.drop_index(
        op.f("current_child_history_child_id_idx"), table_name="current_child_history", schema="api"
    )
    op.drop_table("current_child_history", schema="api")
    op.drop_index(op.f("child_parent_id_idx"), table_name="child", schema="api")
    op.drop_table("child", schema="api")
    op.drop_index(
        op.f("parent_history_opportunity_title_idx"), table_name="parent_history", schema="api"
    )
    op.drop_table("parent_history", schema="api")
    op.drop_index(op.f("parent_opportunity_title_idx"), table_name="parent", schema="api")
    op.drop_table("parent", schema="api")
    op.drop_index(op.f("child_history_parent_id_idx"), table_name="child_history", schema="api")
    op.drop_table("child_history", schema="api")
    # ### end Alembic commands ###
